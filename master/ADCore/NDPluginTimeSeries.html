<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>NDPluginTimeSeries &#8212; areaDetector 3-4-89-g3249b90 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/lbco_32.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NDPluginTransform" href="NDPluginTransform.html" />
    <link rel="prev" title="NDPluginStdArrays" href="NDPluginStdArrays.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          areaDetector</a>
        <span class="navbar-text navbar-version pull-left"><b>3-4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../release.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release.html#versions">Versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Readme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install_guide.html">Install Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#licsense">Licsense</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#installing-and-building-from-source-code">Installing and Building from Source Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#downloading-and-installing-areadetector-source-code">Downloading and Installing areaDetector Source Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#installing-pre-built-binary-versions-of-areadetector">Installing Pre-Built Binary Versions of areaDetector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#display-managers">Display Managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#running-the-ioc-application">Running the IOC Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#image-viewers">Image Viewers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../detectors.html">Supported Detectors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../detectors.html#commuinity-supported-detectors">Commuinity Supported Detectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../detectors.html#areadetector-camera-drivers-supplied-by-3rd-parties">areaDetector camera drivers supplied by 3rd parties</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../legacy_versions.html">Legacy Versions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../legacy_versions.html#required-modules">Required Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../legacy_versions.html#installation-and-building">Installation and Building</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="arch.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="asynPortDriver.html">asynPortDriver</a></li>
<li class="toctree-l2"><a class="reference internal" href="NDArray.html">NDArray</a></li>
<li class="toctree-l2"><a class="reference internal" href="../detector_drivers.html">Detector Drivers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="plugins.html">areaDetector Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="medm.html">MEDM screens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADViewers/ad_viewers.html">areaDetector Viewers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acknowledgements.html">Acknowledgements and licenses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../doxygen.html">Source Code Documentation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">NDPluginTimeSeries</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#screen-shots">Screen shots</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="NDPluginStdArrays.html" title="Previous Chapter: NDPluginStdArrays"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; NDPluginStdArrays</span>
    </a>
  </li>
  <li>
    <a href="NDPluginTransform.html" title="Next Chapter: NDPluginTransform"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">NDPluginTransform &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/ADCore/NDPluginTimeSeries.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="ndplugintimeseries">
<h1><a class="toc-backref" href="#id1">NDPluginTimeSeries</a><a class="headerlink" href="#ndplugintimeseries" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Mark Rivers, University of Chicago</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#ndplugintimeseries" id="id1">NDPluginTimeSeries</a><ul>
<li><a class="reference internal" href="#overview" id="id2">Overview</a></li>
<li><a class="reference internal" href="#configuration" id="id3">Configuration</a></li>
<li><a class="reference internal" href="#screen-shots" id="id4">Screen shots</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This plugin accepts 1-D arrays of dimension [NumSignals] or 2-D arrays
of dimension [NumSignals, NewTimePoints]. The plugin creates NumSignals
NDArrays of dimension [NumTimePoints], each of which is the time-series
for one signal. It also creates an NDArray of dimension [NumTimePoints,
NumSignals] containing the data for all of the signals. It also exports
waveform records containing the time-series data for each signal, and a
time-axis array containing the relative times of each point in the
time-series. These waveform records are useful for plotting in OPI
screens.</p>
<p>On each callback the new time points are appended to the existing time
series arrays. The plugin can operate either two modes. In fixed time
mode the time-series arrays are cleared when acquisition is started, and
new time points are appended until NumTimePoints points have been
received, at which point acquisition stops and further callbacks are
ignored. In circular buffer mode once NumTimePoints samples are received
then acquisition continues with the new time points replacing the oldest
ones in the circular buffer.</p>
<p>The plugin requires knowing the time interval between samples from the
driver (TimePerPoint). This information normally comes from a database
link to a record in the detector driver, but it can be manually
specified as well. The plugin exports a 1-D waveform record containing
the relative time values of each sample, which can be used for the
horizontal axis in an OPI display.</p>
<p>The plugin optionally does time averaging of the input signal. It can
average any integer number of input samples(NumAverage), so that the
time between points in the output waveforms is NumAverage*TimePerPoint =
AveragingTime.</p>
<p>NDPluginTimeSeries inherits from NDPluginDriver. The <a class="reference external" href="../areaDetectorDoxygenHTML/class_n_d_plugin_time_series.html">NDPluginTimeSeries
class
documentation</a>
describes this class in detail.</p>
<p>Several database template files are provided:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Template File Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">NDTimeSeries.template</span></code></td>
<td>This needs to be instantiated
once for each instance of the
plugin. It provides records that
apply to the entire plugin or to
all signals.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">NDTimeSeriesN.template</span></code></td>
<td>This needs to be instantiated
once for each signal in the
plugin (the number must equal the
number of signals specified in
the IOC shell function). The
template provides records that
apply to each signal.</td>
</tr>
</tbody>
</table>
<p>NDPluginTimeSeries inherits from NDPluginDriver.</p>
<p>NDPluginTimeSeries defines the following parameters. It also implements
all of the standard plugin parameters from
<a class="reference internal" href="NDPluginDriver.html"><span class="doc">NDPluginDriver</span></a>. The template files
listed above provide access to these parameters, listed in the following
tables.</p>
<table class="table table-bordered">
  <tbody>
    <tr>
      <td align="center" colspan="7">
        <b>Parameters for entire plugin.
          <br />
          Parameter Definitions in NDPluginTimeSeries.h and EPICS Record Definitions in NDTimeSeries.template</b>
      </td>
    </tr>
    <tr>
      <th>
        Parameter index variable</th>
      <th>
        asyn interface</th>
      <th>
        Access</th>
      <th>
        Description</th>
      <th>
        drvInfo string</th>
      <th>
        EPICS record name</th>
      <th>
        EPICS record type</th>
    </tr>
    <tr>
      <td>
        TSAcquire</td>
      <td>
        asynInt32</td>
      <td>
        r/w</td>
      <td>
        Starts and stops time-series data collection. Value are:
        <br />
        0: "Done": Stops times-series data collection. Performs callbacks on all time-series
        waveform records. The record automatically goes to Done when acquisition completes
        in Fixed Length acquire mode.<br />
        1: "Acquire": Clears all time-series arrays, sets TS_CURRENT_POINT=0, and starts
        time-series data collection. </td>
      <td>
        TS_ACQUIRE</td>
      <td>
        $(P)$(R)TSAcquire<br />
        $(P)$(R)TSAcquiring</td>
      <td>
        busy<br />
        bi</td>
    </tr>
    <tr>
      <td>
        TSRead</td>
      <td>
        asynInt32</td>
      <td>
        r/w</td>
      <td>
        Forces the plugin to do callbacks with the time series NDArrays and waveform records.
        This record SCAN field can be set to periodically update the waveforms. The callbacks
        are automatically done when TSAcquire goes to done at the end of acquisition in
        Fixed Length mode. </td>
      <td>
        TS_READ</td>
      <td>
        $(P)$(R)TSRead</td>
      <td>
        bo</td>
    </tr>
    <tr>
      <td>
        TSNumPoints</td>
      <td>
        asynInt32</td>
      <td>
        r/w</td>
      <td>
        Controls the number of time-series points to collect. There is no maximum value,
        the time-series arrays in the plugin are freed and reallocated each time this value
        is changed. However, the size of the waveform records is fixed when the IOC is started,
        so NELM in those records must be large enough for the largest time-series needed.
      </td>
      <td>
        TS_NUM_POINTS</td>
      <td>
        $(P)$(R)TSNumPoints</td>
      <td>
        longout</td>
    </tr>
    <tr>
      <td>
        TSCurrentPoint</td>
      <td>
        asynInt32</td>
      <td>
        r/o</td>
      <td>
        The current time-series point. In Fixed Length mode when TSCurrentPoint reaches
        TSNumPoints then time-series acquisition is automatically stopped, and callbacks
        are done on all time-series NDArrays and waveform records, updating the values.
        This means that even if TSRead.SCAN is Passive that the NDArrays and waveform records
        will update when time-series acquisition is complete. </td>
      <td>
        TS_CURRENT_POINT</td>
      <td>
        $(P)$(R)TSCurrentPoint</td>
      <td>
        longin</td>
    </tr>
    <tr>
      <td>
        TSAcquireMode</td>
      <td>
        asynInt32</td>
      <td>
        r/w</td>
      <td>
        The time series acquisition mode. Choices are:<br />
        0: "Fixed length"
        <br />
        1: "Circ. buffer" </td>
      <td>
        TS_ACQUIRE_MODE</td>
      <td>
        $(P)$(R)TSAcquireMode<br />
        $(P)$(R)TSAcquireMode_RBV</td>
      <td>
        mbbo
        <br />
        mbbi</td>
    </tr>
    <tr>
      <td>
        TSTimePerPoint</td>
      <td>
        asynFloat64</td>
      <td>
        r/w</td>
      <td>
        The time interval between samples in the waveforms from the driver. This value is
        normally updated automatically using the TSTimePerPointLink record described below.
        It can also be manually changed if there is no EPICS record available to provide
        this value automatically. This value is used to compute NumAverage, and to construct
        the TSTimeAxis array.</td>
      <td>
        TS_TIME_PER_POINT</td>
      <td>
        $(P)$(R)TSTimePerPoint<br />
        $(P)$(R)TSTimePerPoint_RBV</td>
      <td>
        ao<br />
        ai</td>
    </tr>
    <tr>
      <td>
        N.A</td>
      <td>
        N.A.</td>
      <td>
        r/w</td>
      <td>
        This record has OMSL="closed_loop" and DOL set to a record that contains the time
        between points from the driver. The link will normally have the CP attribute, so
        this record processes whenever the input record changes. The OUT field of this record
        is TSTimePerPoint.</td>
      <td>
        N.A.</td>
      <td>
        $(P)$(R)TSTimePerPointLink</td>
      <td>
        ao</td>
    </tr>
    <tr>
      <td>
        TSAveragingTime</td>
      <td>
        asynFloat64</td>
      <td>
        r/w</td>
      <td>
        The requested value of the time interval over which input time-series points are
        averaged. If the TSAveragingTime is not an integer multiple of TSTimePerPoint then
        TSAveragingTime_RBV will be different from TSAveragingTime and will be the actual
        averaging time.</td>
      <td>
        TS_AVERAGING_TIME</td>
      <td>
        $(P)$(R)TSAveragingTime<br />
        $(P)$(R)TSAveragingTime_RBV</td>
      <td>
        ao<br />
        ai</td>
    </tr>
    <tr>
      <td>
        TSNumAverage</td>
      <td>
        asynInt32</td>
      <td>
        r/o</td>
      <td>
        The number of time points from the driver that will be averaged in the plugin. This
        is computed from TSAveragingTime/TSTimePerPoint. It is constrained to be the nearest
        positive integer to this ratio.</td>
      <td>
        TS_NUM_AVERAGE</td>
      <td>
        $(P)$(R)TSNumAverage</td>
      <td>
        longin</td>
    </tr>
    <tr>
      <td>
        TSElapsedTime</td>
      <td>
        asynFloat64</td>
      <td>
        r/w</td>
      <td>
        The elapsed time since TSAcquire was set to 1. Stops updating when TSAcquire goes
        to 0.</td>
      <td>
        TS_ELAPSED_TIME</td>
      <td>
        $(P)$(R)TSElapsedTime</td>
      <td>
        ai</td>
    </tr>
    <tr>
      <td>
        TSTimeAxis</td>
      <td>
        asynFloat64ArrayIn</td>
      <td>
        r/o</td>
      <td>
        A waveform record containing the time value of each point in the TimeSeries waveforms.<br />
        When AcquireMode=&quot;Fixed length&quot; then time=0 is the time when acquisition
        started and
        <br />
        <code>TSTimeAxis[i] = TSAveragingTime_RBV * i.</code>
        <br />
        When AcquireMode=&quot;Circ. buffer&quot; then time=0 is the most recent time and
        <br />
        <code>TSTimeAxis[i] = -TSAveragingTime_RBV * (NumTimePoints-1-i)</code><br />
        so the oldest time point is the most negative.</td>
      <td>
        TS_TIME_AXIS</td>
      <td>
        $(P)$(R)TSTimeAxis</td>
      <td>
        waveform</td>
    </tr>
    <tr>
      <td>
        TSTimeStamp</td>
      <td>
        asynFloat64ArrayIn</td>
      <td>
        r/o</td>
      <td>
        A waveform record containing the NDArray timestamp for each sample from the input
        NDArray. Note that since multiple time points can be contained in a single NDArray
        there can be repeated values in this waveform. Assuming the driver provides a reliable
        value for TSTimePerPoint described above, then the TSTimeAxis waveform provides
        a more accurate relative time array to use in plotting. The values in this waveform
        are absolute timestamps which can also be useful.</td>
      <td>
        TS_TIMESTAMP</td>
      <td>
        $(P)$(R)TSTimestamp</td>
      <td>
        waveform</td>
    </tr>
  </tbody>
</table>
<p>
  <br />
</p>
<table border="1" cellpadding="2" cellspacing="2" style="text-align: left">
  <tbody>
    <tr>
      <td align="center" colspan="7">
        <b>Parameters for each signal N.
          <br />
          Parameter Definitions in NDPluginTimeSeries.h and EPICS Record Definitions in NDTimeSeriesN.template</b>
      </td>
    </tr>
    <tr>
      <th>
        Parameter index variable</th>
      <th>
        asyn interface</th>
      <th>
        Access</th>
      <th>
        Description</th>
      <th>
        drvInfo string</th>
      <th>
        EPICS record name</th>
      <th>
        EPICS record type</th>
    </tr>
    <tr>
      <td>
        TSSignalName</td>
      <td>
        N.A.</td>
      <td>
        r/w</td>
      <td>
        The name for this signal.</td>
      <td>
        N.A.</td>
      <td>
        $(P)$(R)SignalName</td>
      <td>
        stringout</td>
    </tr>
    <tr>
      <td>
        TSTimeSeries</td>
      <td>
        asynFloat64ArrayIn</td>
      <td>
        r/o</td>
      <td>
        The time series data arrays. </td>
      <td>
        TS_TIME_SERIES </td>
      <td>
        $(P)$(R)TimeSeries</td>
      <td>
        waveform</td>
    </tr>
  </tbody>
</table></div>
<div class="section" id="configuration">
<h2><a class="toc-backref" href="#id3">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The NDPluginTimeSeries plugin is created with the <code class="docutils literal notranslate"><span class="pre">NDTimeSeriesConfigure</span></code>
function, either from C/C++ or from the EPICS IOC shell.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NDTimeSeriesConfigure(const char *portName, int queueSize, int blockingCallbacks,
                          const char *NDArrayPort, int NDArrayAddr, int maxSignals,
                          int maxBuffers,  size_t maxMemory, int priority, int stackSize)
</pre></div>
</div>
<p>All but the <code class="docutils literal notranslate"><span class="pre">maxSignals</span></code> parameter are common to all plugins.</p>
<p>maxSignals defines how many signals this plugin will deal with. Usually
this will match the number of NDTimeSeriesN templates have been loaded.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NDTimeSeriesConfigure(&quot;TS1&quot;, 100, 0, &quot;DET1&quot;, 0, 8, 0, 0, 0, 0)
</pre></div>
</div>
</div>
<div class="section" id="screen-shots">
<h2><a class="toc-backref" href="#id4">Screen shots</a><a class="headerlink" href="#screen-shots" title="Permalink to this headline">¶</a></h2>
<p>The following MEDM screen provides access to the parameters in
NDPluginDriver.h and NDPluginTimeSeries.h through records in
NDPluginBase.template, and NDTimeSeries.template.</p>
<div class="figure align-center">
<img alt="../_images/NDPluginTimeSeries.png" src="../_images/NDPluginTimeSeries.png" />
</div>
<p>The following MEDM screen shows the time series plot for an array in
NDPluginTimeSeriesN.template.</p>
<div class="figure align-center">
<img alt="../_images/NDTimeSeriesPlot.png" src="../_images/NDTimeSeriesPlot.png" />
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, Mark Rivers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>